version: "3.8"

networks:
    bluesky-net:
        driver: bridge
        ipam:
            driver: default
            #config:
            #- subnet: 172.19.0.0/24
            #gateway: 172.19.0.1

services:
    postgres_db:
        image: postgres:10-alpine
        environment:
            - POSTGRES_DB=app
            - POSTGRES_USER=username
            - POSTGRES_PASSWORD=password
        networks:
            - bluesky-net
        ports:
            - "6543:5432"
    bluesky:
        restart: always
        image: bluesky
        container_name: bluesky
        user: root
        env_file:
            - .env

        working_dir: /app

        networks:
            - bluesky-net
        ports:
            - "6969:6969"
        volumes:
            - type: bind
              source: .
              target: /app
            - type: bind
              source: data/
              target: /app/data/
            - type: bind
              source: .env
              target: /app/.env
        #command: ["sh", "-c", "make graph-build-up"]
        #command: ["sh", "-c", "pwd && ls -a && cd build && cd graph-builder && ls -a && sleep 120"]
        build:
            context: .
            dockerfile: Dockerfile
        depends_on:
            - "postgres_db"
